



<!doctype html>
<html lang="en" class="no-js">
  <head>
    <!-- BEGIN Kawish's Custom metadata block -->
<!-- Google AdSense -->

      
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5546856204176740",
    enable_page_level_ads: true
  });
</script>
      

<!-- Google Analytics -->

	  
        
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
   
    ga('create', 'UA-143819065-1', 'kawishsiddiqui.com');
    ga('send', 'pageview');
    </script>
	  

<!-- Metadata -->

    <!-- meta description -->
    
     <meta name="description" content="A Data lake contains all data, both raw sources over extended periods of time as well as any processed data.">
    
	
    <!-- meta author -->
    
    <!-- meta keywords -->
    
     <meta name="keywords" content="data lake, datalake, formation, case study, shell, bash, sh, split, size, console, aws, files, tips, cheat, shell command, bash command, script, shell script, sql, teradata, redshift, vba, database, data warehouse, etl, custom, big data">
    

    
    <meta name="robots" content="index, follow">	


      
        <title>DataLake Formation in AWS - Kawish Siddiqui</title>
      

<!-- END Kawish's Custom metadata block -->
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A Data lake contains all data, both raw sources over extended periods of time as well as any processed data.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>DataLake Formation in AWS - Kawish Siddiqui</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-143819065-1", "kawishsiddiqui.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#datalake-formation-in-aws" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Kawish Siddiqui" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic" id="sitename">
            <!--   Kawish Siddiqui -->
				<script> document.getElementById("sitename").innerHTML = window.location.hostname.substr(0, window.location.hostname.indexOf('.')).toUpperCase(); </script></a>
            </span>			
            <span class="md-header-nav__topic">
              
                DataLake Formation in AWS - Kawish Siddiqui
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>		  
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="About Me" class="md-tabs__link">
        About Me
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../sh/split_datafile/" title="Quick Learn" class="md-tabs__link">
          Quick Learn
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../cheetsheets/bigdata/hadoop_chtsht/" title="Cheat Sheets" class="md-tabs__link">
          Cheat Sheets
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../tutorial/redshift/rsintrodwaws/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../event/reinvent/awsri_2018.md" title="Events" class="md-tabs__link">
          Events
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
  
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <script async src='https://cse.google.com/cse.js?cx=partner-pub-5546856204176740:2677115170'></script><div class="gcse-searchbox-only"></div>
	
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Kawish Siddiqui" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Kawish Siddiqui
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="About Me" class="md-nav__link">
      About Me
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Quick Learn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Learn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Shell/Bash
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Shell/Bash
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sh/split_datafile/" title="Split data file" class="md-nav__link">
      Split data file
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      VBA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        VBA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../vba/vba_concatif/" title="ConcatIF Function" class="md-nav__link">
      ConcatIF Function
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Teradata
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Teradata
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../teradata/td_date_diff/" title="Date Diff Function" class="md-nav__link">
      Date Diff Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../teradata/td_turnoff_fallback/" title="Turn off FallBackSetting in Teradata" class="md-nav__link">
      Turn off FallBackSetting in Teradata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4" checked>
    
    <label class="md-nav__link" for="nav-2-4">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        DataLake Formation in AWS
      </label>
    
    <a href="./" title="DataLake Formation in AWS" class="md-nav__link md-nav__link--active">
      DataLake Formation in AWS
    </a>
    
      
<nav class="md-nav md-nav--secondary">


   <div class="a2a_kit">
       <a class="a2a_button_facebook_like" data-action="recommend" data-href="https://kawishsiddiqui.com/" data-layout="box_count" data-width="55"></a>
   </div>
   <script async src="https://static.addtoany.com/menu/page.js"></script>



      
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- kawishsiddiqui TOC -->
            <ins class="adsbygoogle"
                 style="border:none;display:inline-block;width:200px;height:100px"
                 data-ad-client="ca-pub-5546856204176740"
                 data-ad-slot="1250189729"
			 > </ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
      

  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-data-lake-architecture" title="High Level Data Lake Architecture" class="md-nav__link">
    High Level Data Lake Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-data-lake-from-a-relational-data-store" title="Building a Data Lake from a Relational Data Store" class="md-nav__link">
    Building a Data Lake from a Relational Data Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydrating-the-data-lake" title="Hydrating the Data Lake" class="md-nav__link">
    Hydrating the Data Lake
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-glue-data-catalog-of-tier-1-bucket-for-processing" title="Creating Glue Data Catalog of Tier-1 Bucket for processing" class="md-nav__link">
    Creating Glue Data Catalog of Tier-1 Bucket for processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#glue-etl-job-for-tier-2-data" title="Glue ETL Job for Tier-2 Data" class="md-nav__link">
    Glue ETL Job for Tier-2 Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compaction-etl-job" title="Compaction ETL Job" class="md-nav__link">
    Compaction ETL Job
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-data-lake-formation-architecture" title="Detailed Data Lake Formation Architecture" class="md-nav__link">
    Detailed Data Lake Formation Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-elt-pipeline" title="Detailed ELT Pipeline" class="md-nav__link">
    Detailed ELT Pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-performance-considerations" title="Best Practices and Performance Considerations" class="md-nav__link">
    Best Practices and Performance Considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions-additional-considerations" title="Assumptions &amp; Additional Considerations" class="md-nav__link">
    Assumptions &amp; Additional Considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consistency-and-ordering" title="Consistency and Ordering" class="md-nav__link">
    Consistency and Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idempotence" title="Idempotence" class="md-nav__link">
    Idempotence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-tuning-the-dms" title="Performance Tuning the DMS" class="md-nav__link">
    Performance Tuning the DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Redshift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Redshift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../redshift/encrypt_decrypt_udf_using_pyaes/" title="Redshift Encryption UDF" class="md-nav__link">
      Redshift Encryption UDF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redshift/RedshiftQMRActvtMon/" title="Redshift QMR Notification Utility" class="md-nav__link">
      Redshift QMR Notification Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redshift/Vacclyze/" title="Redshift Vacuum Analyze" class="md-nav__link">
      Redshift Vacuum Analyze
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redshift/awslabs_SystemTablePersistence/" title="System Table Persistence" class="md-nav__link">
      System Table Persistence
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Cheat Sheets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Cheat Sheets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Big Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Big Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/hadoop_chtsht/" title="Hadoop" class="md-nav__link">
      Hadoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/pig_chtsht/" title="PIG" class="md-nav__link">
      PIG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/htrn_chtsht/" title="Hortron" class="md-nav__link">
      Hortron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/casestudies/" title="Case Studies" class="md-nav__link">
      Case Studies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Redshift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Redshift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/redshift/rsintrodwaws/" title="Introduction to Data Warehouse in AWS" class="md-nav__link">
      Introduction to Data Warehouse in AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/redshift/rsmoderndwaws/" title="Modernize Your Data Warehouse in AWS" class="md-nav__link">
      Modernize Your Data Warehouse in AWS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Events
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Events
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../event/reinvent/awsri_2018.md" title="re-Invent 2018" class="md-nav__link">
      re-Invent 2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">


   <div class="a2a_kit">
       <a class="a2a_button_facebook_like" data-action="recommend" data-href="https://kawishsiddiqui.com/" data-layout="box_count" data-width="55"></a>
   </div>
   <script async src="https://static.addtoany.com/menu/page.js"></script>



      
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- kawishsiddiqui TOC -->
            <ins class="adsbygoogle"
                 style="border:none;display:inline-block;width:200px;height:100px"
                 data-ad-client="ca-pub-5546856204176740"
                 data-ad-slot="1250189729"
			 > </ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
      

  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-data-lake-architecture" title="High Level Data Lake Architecture" class="md-nav__link">
    High Level Data Lake Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-data-lake-from-a-relational-data-store" title="Building a Data Lake from a Relational Data Store" class="md-nav__link">
    Building a Data Lake from a Relational Data Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydrating-the-data-lake" title="Hydrating the Data Lake" class="md-nav__link">
    Hydrating the Data Lake
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-glue-data-catalog-of-tier-1-bucket-for-processing" title="Creating Glue Data Catalog of Tier-1 Bucket for processing" class="md-nav__link">
    Creating Glue Data Catalog of Tier-1 Bucket for processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#glue-etl-job-for-tier-2-data" title="Glue ETL Job for Tier-2 Data" class="md-nav__link">
    Glue ETL Job for Tier-2 Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compaction-etl-job" title="Compaction ETL Job" class="md-nav__link">
    Compaction ETL Job
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-data-lake-formation-architecture" title="Detailed Data Lake Formation Architecture" class="md-nav__link">
    Detailed Data Lake Formation Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-elt-pipeline" title="Detailed ELT Pipeline" class="md-nav__link">
    Detailed ELT Pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-performance-considerations" title="Best Practices and Performance Considerations" class="md-nav__link">
    Best Practices and Performance Considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions-additional-considerations" title="Assumptions &amp; Additional Considerations" class="md-nav__link">
    Assumptions &amp; Additional Considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consistency-and-ordering" title="Consistency and Ordering" class="md-nav__link">
    Consistency and Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idempotence" title="Idempotence" class="md-nav__link">
    Idempotence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-tuning-the-dms" title="Performance Tuning the DMS" class="md-nav__link">
    Performance Tuning the DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
				<!-- BEGIN Ad -->
				
				      
				<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<ins class="adsbygoogle"
				     style="display:block;height:100px"
				     data-ad-layout="in-article"
				     data-ad-format="fluid"
				     data-ad-client="ca-pub-5546856204176740"
				     data-ad-slot="5536919095"></ins>
				<script>
				     (adsbygoogle = window.adsbygoogle || []).push({});
				</script>
				      
				
				<!-- END Ad -->
				
                <div class="admonition important">
<p class="admonition-title">Disclaimer:</p>
<p><div id="disclaimer"> </div>
<p id="credit"></p></p>
</div>
<div class="admonition note">
<p class="admonition-title">Important</p>
<p>This code must not be used for production use as is. This sample is developed only to educate the users in using some of the features of the AWS in developing a ETL Pipeline using AWS Glue and other services. This is my personal github location and is maintained solely by me.
 This is not the official AWS Open source repository.</p>
</div>
<h1 id="datalake-formation-in-aws">DataLake Formation in AWS</h1>
<p>A Data lake contains all data, both raw sources over extended periods of time as well as any processed data. They enable users across multiple business units to refine, explore and enrich data on their terms. Also, enables multiple data access patterns across a shared infrastructure: batch, interactive, online, search, in-memory and other processing engines.</p>
<p>AWS Glue provides a serverless Spark-based data processing service. Glue is based on open source frameworks like Apache Spark and the Hive Metastore. This allows our users to go beyond the traditional ETL use cases into more data prep and data processing spanning data exploration, data science, and ofcourse data prep for analytics. 
Glue helps users do three things – Discover and understand their data by cataloguing it into a central metadata Catalog, offering libraries and tools to efficiently develop their data prep code, and then run it at scale on a serverless, full managed environment. </p>
<p>The backbone storage service for Data Lake best suited is AWS S3. The native features of S3 are exactly what you want from a Data Lake - Replication across AZ’s for high availability and durability, Massively parallel, scalable (Storage scales independent of compute) and Low storage cost.</p>
<h2 id="high-level-data-lake-architecture">High Level Data Lake Architecture</h2>
<p><img alt="" src="https://github.com/dhawalkp/datalake/raw/master/High_Level_architecture_DataLake.png" /></p>
<h2 id="building-a-data-lake-from-a-relational-data-store">Building a Data Lake from a Relational Data Store</h2>
<p>This repository contains the sample reference implementation to create data lake from Relational Database services as one of the sources.</p>
<ul>
<li>
<p>Source RDS Customer Table Schema can be created by crawler through AWS Glue Crawlers</p>
</li>
<li>
<p>Sample Full Log Customer record format generated by DMS:
The sample cdc log file is in data/Tier-1/Customer/Full/ folder structure </p>
</li>
<li>
<p>Sample CDC Log Customer Record format generated by DMS 
The sample cdc log file is in repo folder - &ldquo;/data/Tier-1/Customer/CDC/YYYY/MM/DD&rdquo; folder structure assuming the data are initially partitioned based on the day</p>
</li>
</ul>
<p>Please notice the additional OP column in CDC log file added by DMS to tag the type of change.</p>
<p>The implementation consists of </p>
<h2 id="hydrating-the-data-lake">Hydrating the Data Lake</h2>
<ul>
<li>AWS RDS backed by Oracle DB engine integrating with AWS DMS service generating Full and CDC Log files and storing the files on Tier-1 S3 Bucket. Alternatively, the Tier-1 bucket can be hydrated by periodic export process that dumps all the changes as well.</li>
<li>The Tier-1 bucket in this example is partitioned based on year/month/day/hour</li>
</ul>
<h2 id="creating-glue-data-catalog-of-tier-1-bucket-for-processing">Creating Glue Data Catalog of Tier-1 Bucket for processing</h2>
<ul>
<li>AWS Glue Crawlers needs to be configured in order to process CDC and Full Log files in the tier-1 bucket and create data catalog for both. In this case, the Tier-1 Database in Glue will consist of 2 tables i.e. CDC and Full</li>
</ul>
<h2 id="glue-etl-job-for-tier-2-data">Glue ETL Job for Tier-2 Data</h2>
<ul>
<li>Tier-2 ETL job will re-partition based on required keys and hydrate the tier-2 buckets in S3 with S3 Objects based on the partition keys. The script is available in this repo with name - /scripts/DMS_CDC_Tier2_Repartitioning_CustomerID.py and /scripts/DMS_FullLog_Tier2_Repartitioning_CustomerID.py</li>
<li>The Tier-2 S3 bucket will eventually have Partitions consisting of multiple versions of S3 Objects for same key.</li>
</ul>
<h2 id="compaction-etl-job">Compaction ETL Job</h2>
<ul>
<li>The Compaction job i.e. /scripts/Compaction.py basically deletes the older versions of Objects for all the partitions in tier-2 bucket. In this example, the script uses the last modified time stamp of S3 Object to build the compaction logic. Please refer to additional considerations section below in this documentation for alternative approaches to preserve the consistency.</li>
</ul>
<h2 id="detailed-data-lake-formation-architecture">Detailed Data Lake Formation Architecture</h2>
<p><img alt="" src="https://github.com/dhawalkp/datalake/raw/master/Data_Pipeline_Architecture.png" /></p>
<h2 id="detailed-elt-pipeline">Detailed ELT Pipeline</h2>
<p><img alt="" src="https://github.com/dhawalkp/datalake/raw/master/Compaction.png" /></p>
<h2 id="best-practices-and-performance-considerations">Best Practices and Performance Considerations</h2>
<ul>
<li>
<p>One of the key design decisions in making the solution performant will be the selection of appropriate partition keys for target S3 buckets. Please read <a href="https://aws.amazon.com/blogs/big-data/work-with-partitioned-data-in-aws-glue/">Working with Partitioned Data in AWS Glue</a>. Partitioning the Source and Target Buckets via Relevant Partition Keys and making use of it in avoiding cross partition joins or full scans.</p>
</li>
<li>
<p>Use Parquet or ORC and S3 Paths for formatting and organizing the data as per partition keys with Compression like Snappy/Gzip formats</p>
</li>
<li>Use Glue DynamicFrames and make use of PushDownPRedicates based on Partitions to improve/reduce on GETs/PUTs to S3</li>
<li>Use applyMapping wherever possible to restrict the columns</li>
<li>In Writing the dynamic frames into partitioned sinks, try to use additional Partitionkeys option so that you can directly write it from DynamicFrame instead of doing intermediate conversion into Spark DataFrame.</li>
<li>Use Compaction Technique periodically to delete the old objects for the same key.</li>
<li>DMS CDC/Full Load files contains timestamp in the name and should be used to process the data based on this. Care must be taken to make sure multiple CDC Records for same key are not processed in parallel to avoid Data Consistency issues during CDC records consolidation phase.</li>
</ul>
<h2 id="assumptions-additional-considerations">Assumptions &amp; Additional Considerations</h2>
<h3 id="consistency-and-ordering">Consistency and Ordering</h3>
<ul>
<li>
<p>Multiple changes on the same record can appear in a CDC file generated by AWS DMS.Though, CDC guarantees the files delivered to S3 are in order. The transaction integrity can be maintained as long as you follow the ordering of changes in the file and across sequence of files. The recommendation will be to also have Modification Time Stamp embedded in the source table so that the consistency can be maintained. The Alternative approach to not having modification time stamp in the source table will be to implement pre-tier-1 ETL job that transforms the CDC records and add a synthetic sequence number.</p>
</li>
<li>
<p>Since S3 updates are eventual consistent, a mechanism needs to be developed to make sure the data being queried are not being mutated at the same time. You have to employ the use of temporary scratch location and then compact in tier-3 bucket for example.</p>
</li>
<li>There may be delays in S3 Upserts and so reliance on S3 Object Last Modified Time may cause inconsistent results. An alternative approach could be to use the DMS CDC logtimestamp or Update Time Stamp column (if present) of the original data and add as meta data in S3 Object and use that for compaction job.</li>
</ul>
<h3 id="idempotence">Idempotence</h3>
<ul>
<li>The ETL job should be aware of idempotence requirements. Since CDC Records presents the latest copy of entire record, the idempotence should not be a concern for ETL job in this case.</li>
</ul>
<h3 id="performance-tuning-the-dms">Performance Tuning the DMS</h3>
<ul>
<li>The solution must be aware of the performance tuning and limits of DMS service as mentioned <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_BestPractices.html">here</a> </li>
</ul>
<script>
    var git_user = "dhawalkp";
    var git_tree = ""
    var git_repo_name = "datalake";
    var git_repo_path = git_user + "/datalake";
//
// Disclaimer Code
    var disc_line = "<i>Information on this page is based on the article published by ";
    disc_line = disc_line + "<a href='https://github.com/" + git_user + "'>" + git_user + "</a>"
    disc_line = disc_line + " at ";
    disc_line = disc_line + " <a href='https://github.com/" + git_repo_path + "'>" + git_repo_name + "</a> ";
    disc_line = disc_line + " and not owned or represented by [";
    disc_line = disc_line + "<a href='" + window.location.hostname +"'>" + window.location.hostname + "</a> ] ";
    disc_line = disc_line + "or this article is true and accurate to the best of the authors' knowledge. ";
    disc_line = disc_line + "Information on this site should be verified and tested before usage at your own effort and risk and <b>should not be considered as Official sources by any mean through this website.<b></i>";
    document.getElementById("disclaimer").innerHTML = disc_line;    
 </script>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">

					   


  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        [ &copy; <script> document.write("<a href='" + window.location.href +"'>" + window.location.hostname + "</a> ] "); </script>
        
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/ksiddiqui79" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/iamkawish" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/kawish" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    

<div class="a2a_kit a2a_floating_style a2a_vertical_style" style="right:20px; bottom:20px;">
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_whatsapp"></a>
    <a class="a2a_button_email"></a>
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
</div>

<script async src="https://static.addtoany.com/menu/page.js"></script>
  </body>
</html>