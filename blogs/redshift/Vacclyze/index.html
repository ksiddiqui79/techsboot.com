



<!doctype html>
<html lang="en" class="no-js">
  <head>
    <!-- BEGIN Kawish's Custom metadata block -->
<!-- Google AdSense -->

      
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5546856204176740",
    enable_page_level_ads: true
  });
</script>
      

<!-- Google Analytics -->

	  
        
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
   
    ga('create', 'UA-143819065-1', 'kawishsiddiqui.com');
    ga('send', 'pageview');
    </script>
	  

<!-- Metadata -->

    <!-- meta description -->
    
     <meta name="description" content="Analyze & Vacuum Schema Utility.">
    
	
    <!-- meta author -->
    
    <!-- meta keywords -->
    
     <meta name="keywords" content="wlm, workload, monitoring, rule, qmr, encrypt, decryption, decrypt, encryption, udf, amazon, function, utility, vacuum, analyze, data lake, datalake, formation, case study, shell, bash, sh, split, size, console, aws, files, tips, cheat, shell command, bash command, script, shell script, sql, teradata, redshift, vba, database, data warehouse, etl, custom, big data">
    

    
    <meta name="robots" content="index, follow">	


      
        <title>Analyze & Vacuum Schema Utility</title>
      

<!-- END Kawish's Custom metadata block -->
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Analyze & Vacuum Schema Utility.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Analyze & Vacuum Schema Utility</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-143819065-1", "kawishsiddiqui.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#analyze-vacuum-schema-utility" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Kawish Siddiqui" class="md-header-nav__button md-logo">
          
            <i class="md-icon">î Œ</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic" id="sitename">
            <!--   Kawish Siddiqui -->
				<script> document.getElementById("sitename").innerHTML = window.location.hostname.substr(0, window.location.hostname.indexOf('.')).toUpperCase(); </script></a>
            </span>			
            <span class="md-header-nav__topic">
              
                Analyze & Vacuum Schema Utility
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">		
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>		  
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="About Me" class="md-tabs__link">
        About Me
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../sh/split_datafile/" title="Blogs" class="md-tabs__link">
          Blogs
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../cheetsheets/bigdata/hadoop_chtsht/" title="Cheat Sheets" class="md-tabs__link">
          Cheat Sheets
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../tutorial/redshift/rsintrodwaws/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../event/reinvent/awsri_2018.md" title="Events" class="md-tabs__link">
          Events
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
  
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
<img src="https://smallseotools.com/counterDisplay?code=ab8260dea84197452b9dfab712d575f6&style=0004&pad=8&type=page&initCount=620" alt="counter for traffic" border="0">
		<!--
		<img class="navbar-brand" src="http://www.cutercounter.com/hit.php?id=gqfcck&nd=8&style=148" alt="free counter" border="0"> 
        Start of CuterCounter Code 
		-->
    <script async src='https://cse.google.com/cse.js?cx=partner-pub-5546856204176740:2677115170'></script><div class="gcse-searchbox-only"></div>
	
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Kawish Siddiqui" class="md-nav__button md-logo">
      
        <i class="md-icon">î Œ</i>
      
    </a>
    Kawish Siddiqui
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="About Me" class="md-nav__link">
      About Me
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Blogs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Blogs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Shell/Bash
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Shell/Bash
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sh/split_datafile/" title="Split data file" class="md-nav__link">
      Split data file
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      VBA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        VBA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../vba/vba_concatif/" title="ConcatIF Function" class="md-nav__link">
      ConcatIF Function
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Teradata
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Teradata
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../teradata/td_date_diff/" title="Date Diff Function" class="md-nav__link">
      Date Diff Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../teradata/td_turnoff_fallback/" title="Turn off FallBackSetting in Teradata" class="md-nav__link">
      Turn off FallBackSetting in Teradata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/dl_form_aws/" title="DataLake Formation in AWS" class="md-nav__link">
      DataLake Formation in AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/s3lmbglueredshift/" title="Beginners - Automated Amazon Redshift Database Loader" class="md-nav__link">
      Beginners - Automated Amazon Redshift Database Loader
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5" checked>
    
    <label class="md-nav__link" for="nav-2-5">
      Redshift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Redshift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../encrypt_decrypt_udf_using_pyaes/" title="Redshift Encryption UDF" class="md-nav__link">
      Redshift Encryption UDF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RedshiftQMRActvtMon/" title="Redshift QMR Notification Utility" class="md-nav__link">
      Redshift QMR Notification Utility
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Redshift Vacuum Analyze
      </label>
    
    <a href="./" title="Redshift Vacuum Analyze" class="md-nav__link md-nav__link--active">
      Redshift Vacuum Analyze
    </a>
    
      
<nav class="md-nav md-nav--secondary">


   <div class="a2a_kit">
       <a id="fblike" class="a2a_button_facebook_like" data-action="recommend" data-href="https://kawishsiddiqui.com/" data-layout="box_count" data-width="55"></a>
   </div>
   <script async src="https://static.addtoany.com/menu/page.js"></script>



      
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- kawishsiddiqui TOC -->
            <ins class="adsbygoogle"
                 style="border:none;display:inline-block;width:200px;height:100px"
                 data-ad-client="ca-pub-5546856204176740"
                 data-ad-slot="1250189729"
			 > </ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
      

  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vacuum" title="Vacuum" class="md-nav__link">
    Vacuum
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1" title="Phase 1:" class="md-nav__link">
    Phase 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2" title="Phase 2:" class="md-nav__link">
    Phase 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze" title="Analyze" class="md-nav__link">
    Analyze
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1_1" title="Phase 1:" class="md-nav__link">
    Phase 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2_1" title="Phase 2:" class="md-nav__link">
    Phase 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-parameters" title="Summary of Parameters:" class="md-nav__link">
    Summary of Parameters:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameter-guidance" title="Parameter Guidance" class="md-nav__link">
    Parameter Guidance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-name" title="Schema Name" class="md-nav__link">
    Schema Name
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slot-count" title="Slot Count" class="md-nav__link">
    Slot Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-flag" title="analyze-flag" class="md-nav__link">
    analyze-flag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vacuum-flag" title="vacuum-flag" class="md-nav__link">
    vacuum-flag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vacuum-parameter" title="vacuum-parameter" class="md-nav__link">
    vacuum-parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min-unsorted-pct" title="min-unsorted-pct" class="md-nav__link">
    min-unsorted-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-unsorted-pct" title="max-unsorted-pct" class="md-nav__link">
    max-unsorted-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats-off-pct" title="stats-off-pct" class="md-nav__link">
    stats-off-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-table-size-mb" title="max-table-size-mb" class="md-nav__link">
    max-table-size-mb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicate-cols" title="predicate-cols" class="md-nav__link">
    predicate-cols
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-usage" title="Sample Usage" class="md-nav__link">
    Sample Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-notes" title="Install Notes" class="md-nav__link">
    Install Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" title="Limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../awslabs_SystemTablePersistence/" title="System Table Persistence" class="md-nav__link">
      System Table Persistence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../second_level/" title="Second Level" class="md-nav__link">
      Second Level
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Cheat Sheets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Cheat Sheets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Big Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Big Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/hadoop_chtsht/" title="Hadoop" class="md-nav__link">
      Hadoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/pig_chtsht/" title="PIG" class="md-nav__link">
      PIG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/htrn_chtsht/" title="Hortron" class="md-nav__link">
      Hortron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cheetsheets/bigdata/casestudies/" title="Case Studies" class="md-nav__link">
      Case Studies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Redshift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Redshift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/redshift/rsintrodwaws/" title="Introduction to Data Warehouse in AWS" class="md-nav__link">
      Introduction to Data Warehouse in AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/redshift/rsmoderndwaws/" title="Modernize Your Data Warehouse in AWS" class="md-nav__link">
      Modernize Your Data Warehouse in AWS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Events
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Events
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../event/reinvent/awsri_2018.md" title="re-Invent 2018" class="md-nav__link">
      re-Invent 2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">


   <div class="a2a_kit">
       <a id="fblike" class="a2a_button_facebook_like" data-action="recommend" data-href="https://kawishsiddiqui.com/" data-layout="box_count" data-width="55"></a>
   </div>
   <script async src="https://static.addtoany.com/menu/page.js"></script>



      
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- kawishsiddiqui TOC -->
            <ins class="adsbygoogle"
                 style="border:none;display:inline-block;width:200px;height:100px"
                 data-ad-client="ca-pub-5546856204176740"
                 data-ad-slot="1250189729"
			 > </ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
      

  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vacuum" title="Vacuum" class="md-nav__link">
    Vacuum
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1" title="Phase 1:" class="md-nav__link">
    Phase 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2" title="Phase 2:" class="md-nav__link">
    Phase 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze" title="Analyze" class="md-nav__link">
    Analyze
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1_1" title="Phase 1:" class="md-nav__link">
    Phase 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2_1" title="Phase 2:" class="md-nav__link">
    Phase 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-parameters" title="Summary of Parameters:" class="md-nav__link">
    Summary of Parameters:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameter-guidance" title="Parameter Guidance" class="md-nav__link">
    Parameter Guidance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-name" title="Schema Name" class="md-nav__link">
    Schema Name
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slot-count" title="Slot Count" class="md-nav__link">
    Slot Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-flag" title="analyze-flag" class="md-nav__link">
    analyze-flag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vacuum-flag" title="vacuum-flag" class="md-nav__link">
    vacuum-flag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vacuum-parameter" title="vacuum-parameter" class="md-nav__link">
    vacuum-parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min-unsorted-pct" title="min-unsorted-pct" class="md-nav__link">
    min-unsorted-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-unsorted-pct" title="max-unsorted-pct" class="md-nav__link">
    max-unsorted-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats-off-pct" title="stats-off-pct" class="md-nav__link">
    stats-off-pct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-table-size-mb" title="max-table-size-mb" class="md-nav__link">
    max-table-size-mb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicate-cols" title="predicate-cols" class="md-nav__link">
    predicate-cols
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-usage" title="Sample Usage" class="md-nav__link">
    Sample Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-notes" title="Install Notes" class="md-nav__link">
    Install Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" title="Limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
				<!-- BEGIN Ad -->
				
				      
				<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<ins class="adsbygoogle"
				     style="display:block;height:100px"
				     data-ad-layout="in-article"
				     data-ad-format="fluid"
				     data-ad-client="ca-pub-5546856204176740"
				     data-ad-slot="5536919095"></ins>
				<script>
				     (adsbygoogle = window.adsbygoogle || []).push({});
				</script>
				      
				
				<!-- END Ad -->
				
                <h1 id="analyze-vacuum-schema-utility">Analyze &amp; Vacuum Schema Utility</h1>
<p>In order to get the best performance from your Redshift Database, you must ensure that database tables regularly analyzed and vacuumed. For more information , please read the below Redshift documentation,</p>
<p>http://docs.aws.amazon.com/redshift/latest/dg/t_Reclaiming_storage_space202.html
http://docs.aws.amazon.com/redshift/latest/dg/t_Analyzing_tables.html</p>
<p>Whenever you insert, delete, or update (In Redshift update = delete + insert) a significant number of rows, you should run a VACUUM command and then an ANALYZE command. 
In Redshift, the data blocks are immutable, i.e. when rows are DELETED or UPDATED against a table they are simply logically deleted (flagged for deletion), but not physically removed from disk. This causes the rows to continue consuming disk space and those blocks are scanned when a query scans the table. The result of this, table storage space is increased and degraded performance due to otherwise avoidable disk IO during scans. A vacuum recovers the space from deleted rows and restores the sort order. </p>
<p>To avoid resource intensive VACUUM operation, you can load the data in sort key order, or design your table maintain data for a rolling time period, using time series tables. </p>
<p>If your table has a large unsorted region (which canâ€™t be vacuumed), a deep copy is much faster than a vacuum. You can use the Column Encoding Utility from our open source GitHub project https://github.com/awslabs/amazon-redshift-utils to perform a deep copy. The Column Encoding Utility takes care of the compression analysis, column encoding and deep copy.</p>
<p>The ANALYZE command updates the statistics metadata, which enables the query optimizer to generate more accurate query plans. COPY automatically updates statistics after loading an empty table, so your statistics should be up to date. </p>
<p>The Redshift â€˜Analyze Vacuum Utilityâ€™ gives you the ability to automate VACUUM and ANALYZE operations. When run, it will VACUUM or ANALYZE an entire schema or individual tables. </p>
<p>This Utility Analyzes and Vacuums table(s) in a Redshift Database schema, based on certain parameters like unsorted, stats off and size of the table and system alerts from <code>stl_explain</code> &amp; <code>stl_alert_event_log</code>. By turning on/off &lsquo;&ndash;analyze-flagâ€™ and  &lsquo;&ndash;vacuum-flag&rsquo; parameters, you can run it as  &lsquo;vacuum-only&rsquo; or  &lsquo;analyze-only&rsquo; utility. This script can be scheduled to run VACUUM and ANALYZE as part of regular maintenance/housekeeping activities, when there are fewer database activities.</p>
<h2 id="vacuum">Vacuum</h2>
<p>This script runs vacuum in two phases,</p>
<h3 id="phase-1">Phase 1:</h3>
<p>Identify and run vacuum based on the alerts recorded in <code>stl_alert_event_log</code>. <code>stl_alert_event_log</code>, records an alert when the query optimizer identifies conditions that might indicate performance issues. We can use the <code>stl_alert_event_log</code> table to identify the top 25 tables that need vacuum. The script uses SQL to get the list of tables and number of alerts, which indicate that vacuum is required.</p>
<p>Variables affecting this phase:</p>
<ul>
<li><code>goback_no_of_days</code>: To control number days to look back from CURRENT_DATE</li>
</ul>
<h3 id="phase-2">Phase 2:</h3>
<p>Identify and run vacuum based on certain thresholds related to table statistics (Like unsorted &gt; 10% and Stats Off &gt; 10% and limited to specific table sizes.</p>
<p>Variables affecting this phase:</p>
<ul>
<li><code>stats_off_pct</code>: To control the threshold of statistics inaccuracy</li>
<li><code>min_unsorted_pct</code>: To control the lower limit of unsorted blocks</li>
<li><code>max_unsorted_pct</code>: To control the upper limit of unsorted blocks (preventing vacuum on super large tables)</li>
<li><code>max_tbl_size_mb</code>: To control when a table is too large to be vacuumed by this utility</li>
</ul>
<h2 id="analyze">Analyze</h2>
<p>This script runs Analyze in two phases:</p>
<h3 id="phase-1_1">Phase 1:</h3>
<p>Run ANALYZE based on the alerts recorded in <code>stl_explain</code> &amp; <code>stl_alert_event_log</code>. </p>
<h3 id="phase-2_1">Phase 2:</h3>
<p>Run ANALYZE based the <code>stats_off</code> metric in <code>svv_table_info</code>. If table has a <code>stats_off_pct</code> &gt; 10%, then the script runs ANALYZE command to update the statistics.</p>
<h2 id="summary-of-parameters">Summary of Parameters:</h2>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="center">Mandatory</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">&ndash;db</td>
<td align="center">Yes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;db-user</td>
<td align="center">Yes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;db-pwd</td>
<td align="center">Yes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;db-host</td>
<td align="center">Yes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;db-port</td>
<td align="center">No</td>
<td align="left">5439</td>
</tr>
<tr>
<td align="left">&ndash;db-conn-opts</td>
<td align="center">No</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;schema-name</td>
<td align="center">No</td>
<td align="left">Public</td>
</tr>
<tr>
<td align="left">&ndash;table-name</td>
<td align="center">No</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;output-file</td>
<td align="center">Yes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ndash;debug</td>
<td align="center">No</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left">&ndash;slot-count</td>
<td align="center">No</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">&ndash;ignore-errors</td>
<td align="center">No</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left">&ndash;query_group</td>
<td align="center">No</td>
<td align="left">None</td>
</tr>
<tr>
<td align="left">&ndash;analyze-flag</td>
<td align="center">No</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left">&ndash;vacuum-flag</td>
<td align="center">No</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left">&ndash;vacuum-parameter</td>
<td align="center">No</td>
<td align="left">FULL</td>
</tr>
<tr>
<td align="left">&ndash;min-unsorted-pct</td>
<td align="center">No</td>
<td align="left">0.05</td>
</tr>
<tr>
<td align="left">&ndash;max-unsorted-pct</td>
<td align="center">No</td>
<td align="left">0.5</td>
</tr>
<tr>
<td align="left">&ndash;stats-off-pct</td>
<td align="center">No</td>
<td align="left">0.1</td>
</tr>
<tr>
<td align="left">&ndash;stats-threshold</td>
<td align="center">No</td>
<td align="left">0.1</td>
</tr>
<tr>
<td align="left">&ndash;max-table-size-mb</td>
<td align="center">No</td>
<td align="left">700*1024</td>
</tr>
<tr>
<td align="left">&ndash;predicate-cols</td>
<td align="center">No</td>
<td align="left">False</td>
</tr>
</tbody>
</table>
<p>The above parameter values depend on the cluster type, table size, available system resources and available â€˜Time windowâ€™ etc. The default values provided here are based on ds2.8xlarge, 8 node cluster. It may take some trial and error to come up with correct parameter values to vacuum and analyze your table(s). If table size is greater than certain size (<code>max_table_size_mb</code>) and has a large unsorted region (<code>max_unsorted_pct</code>), consider performing a deep copy, which will be much faster than a vacuum.</p>
<p>As VACUUM &amp; ANALYZE operations are resource intensive, you should ensure that this will not adversely impact other database operations running on your cluster. AWS has thoroughly tested this software on a variety of systems, but cannot be responsible for the impact of running the utility against your database.</p>
<h3 id="parameter-guidance">Parameter Guidance</h3>
<h3 id="schema-name">Schema Name</h3>
<p>The utility will accept a valid schema name, or alternative a regular expression pattern which will be used to match to all schemas in the database. This uses Posix regular expression syntax. You can use <code>(.*)</code> to match all schemas. </p>
<h4 id="slot-count">Slot Count</h4>
<p>Sets the number of query slots a query will use.</p>
<p>Workload management (WLM) reserves slots in a service class according to the concurrency level set for the queue (for example, if concurrency level is set to 5, then the service class has 5 slots). WLM allocates the available memory for a service class equally to each slot. For more information, see Implementing Workload Management.</p>
<p>For operations where performance is heavily affected by the amount of memory allocated, such as Vacuum, increasing the value of wlm_query_slot_count can improve performance. In particular, for slow Vacuum commands, inspect the corresponding record in the <code>SVV_VACUUM_SUMMARY</code> view. If you see high values (close to or higher than 100) for <code>sort_partitions</code> and <code>merge_increments</code> in the <code>SVV_VACUUM_SUMMARY</code> view, consider increasing the value for <code>wlm_query_slot_count</code> the next time you run Vacuum against that table.</p>
<p>Increasing the value of wlm_query_slot_count limits the number of concurrent queries that can be run.</p>
<p>Note:</p>
<p>If the value of <code>wlm_query_slot_count</code> is larger than the number of available slots (concurrency level) for the queue targeted by the user, the utilty will fail. If you encounter an error, decrease <code>wlm_query_slot_count</code> to an allowable value.</p>
<h4 id="analyze-flag">analyze-flag</h4>
<p>Flag to turn ON/OFF ANALYZE functionality (True or False). If you want run the script to only perform ANALYZE on a schema or table, set this value â€˜Falseâ€™ : Default = â€˜Falseâ€™.</p>
<h4 id="vacuum-flag">vacuum-flag</h4>
<p>Flag to turn ON/OFF VACUUM functionality (True or False). If you want run the script to only perform VACUUM on a schema or table, set this value â€˜Falseâ€™ : Default = â€˜Falseâ€™.</p>
<h4 id="vacuum-parameter">vacuum-parameter</h4>
<p>Specify vacuum parameters [ <code>FULL | SORT ONLY | DELETE ONLY | REINDEX</code> ] Default = FULL</p>
<h4 id="min-unsorted-pct">min-unsorted-pct</h4>
<p>Minimum unsorted percentage (%) to consider a table for vacuum: Default = 5%.</p>
<h4 id="max-unsorted-pct">max-unsorted-pct</h4>
<p>Maximum unsorted percentage(%) to consider a table for vacuum : Default = 50%.</p>
<h4 id="stats-off-pct">stats-off-pct</h4>
<p>Minimum stats off percentage(%) to consider a table for analyze : Default = 10%</p>
<h4 id="max-table-size-mb">max-table-size-mb</h4>
<p>Maximum table size 700GB in MB : Default = 700*1024 MB</p>
<h4 id="predicate-cols">predicate-cols</h4>
<p>Analyze predicate columns only. Default = False</p>
<h2 id="sample-usage">Sample Usage</h2>
<pre><code>python analyze-vacuum-schema.py  --db &lt;&gt; --db-user &lt;&gt; --db-pwd &lt;&gt; --db-port 8192 --db-host aaa.us-west-2.redshift.amazonaws.com --schema-name public  --table-name customer_v6 --output-file /Users/test.log --debug True  --ignore-errors False --slot-count 2 --min-unsorted-pct 5 --max-unsorted-pct 50 --stats-off-pct 10 --max-table-size-mb 700*1024
</code></pre>

<h2 id="install-notes">Install Notes</h2>
<pre><code>sudo easy_install pip  
sudo pip install 
</code></pre>

<h2 id="limitations">Limitations</h2>
<ol>
<li>Script runs all VACUUM commands sequentially. Currently in Redshift multiple concurrent vacuum operations are not supported. </li>
<li>Script runs all ANALYZE commands sequentially not concurrently.</li>
<li>Does not support column level ANALYZE. </li>
<li>Multiple schemas are not supported.</li>
<li>Skew factor is not considered.</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">

					   


  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        [ &copy; <script> document.write("<a href='" + window.location.href +"'>" + window.location.hostname + "</a> ] "); </script>
        
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/ksiddiqui79" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/iamkawish" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/kawish" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    

<div class="a2a_kit a2a_floating_style a2a_vertical_style" style="right:20px; bottom:20px;">
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_whatsapp"></a>
    <a class="a2a_button_email"></a>
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
</div>

<script async src="https://static.addtoany.com/menu/page.js"></script>
  </body>
</html>